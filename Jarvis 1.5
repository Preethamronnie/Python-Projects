import tkinter as tk
from tkinter import scrolledtext
from datetime import datetime
from openai import OpenAI

# ===================== AI INITIALIZATION ===================== #

client = OpenAI()

conversation = [
    {
        "role": "system",
        "content": (
            "You are Jarvis, an intelligent, polite AI assistant. "
            "You help with general queries and technical questions. "
            "Be concise, accurate, and professional."
        )
    }
]

# ===================== AI RESPONSE FUNCTION ===================== #

def get_ai_response(user_input):
    conversation.append({"role": "user", "content": user_input})

    response = client.chat.completions.create(
        model="gpt-4o-mini",
        messages=conversation,
        temperature=0.7
    )

    reply = response.choices[0].message.content
    conversation.append({"role": "assistant", "content": reply})
    return reply

# ===================== GUI LOGIC ===================== #

def send_message():
    user_input = user_entry.get().strip()
    if not user_input:
        return

    chat_area.config(state=tk.NORMAL)
    chat_area.insert(tk.END, f"You: {user_input}\n")
    chat_area.config(state=tk.DISABLED)
    chat_area.yview(tk.END)

    user_entry.delete(0, tk.END)

    if user_input.lower() in ["bye", "exit", "quit", "goodbye"]:
        chat_area.config(state=tk.NORMAL)
        chat_area.insert(tk.END, "Jarvis: Goodbye! Have a great day.\n")
        chat_area.config(state=tk.DISABLED)
        return

    if "time" in user_input.lower():
        reply = f"The current time is {datetime.now().strftime('%I:%M %p')}"
    elif "date" in user_input.lower() or "day" in user_input.lower():
        reply = f"Today is {datetime.now().strftime('%A, %B %d, %Y')}"
    else:
        reply = get_ai_response(user_input)

    chat_area.config(state=tk.NORMAL)
    chat_area.insert(tk.END, f"Jarvis: {reply}\n\n")
    chat_area.config(state=tk.DISABLED)
    chat_area.yview(tk.END)

# ===================== GUI SETUP ===================== #

root = tk.Tk()
root.title("JARVIS â€“ AI Assistant")
root.geometry("650x520")
root.resizable(False, False)

chat_area = scrolledtext.ScrolledText(
    root,
    wrap=tk.WORD,
    font=("Segoe UI", 11),
    state=tk.DISABLED
)
chat_area.pack(padx=10, pady=10, fill=tk.BOTH, expand=True)

user_entry = tk.Entry(root, font=("Segoe UI", 11))
user_entry.pack(padx=10, pady=5, fill=tk.X)

send_btn = tk.Button(
    root,
    text="Send",
    font=("Segoe UI", 10),
    width=10,
    command=send_message
)
send_btn.pack(pady=5)

user_entry.bind("<Return>", lambda event: send_message())

# ===================== START MESSAGE ===================== #

chat_area.config(state=tk.NORMAL)
chat_area.insert(tk.END, "Jarvis: Hello! I am ready to assist you.\n\n")
chat_area.config(state=tk.DISABLED)

root.mainloop()
